<div class="dropdown">
    <span class="badge bg-danger notification-badge" onclick="showNotifications()">{{ notifications.count }}</span>
    <div class="dropdown-content d-none" id="notification-container">
        {% for notification in notifications %}
            {% if notification.Class %}
                {% if notification.notification_type == 1 %}
                <div class="dropdown-item-parent">
                    <a href="{% url 'ClassNotifications' notification.id notification.Class.id %}">@{{ notification.from_user }} subscribed {{notification.Class}} </a>
                    <span class="dropdown-item-close" onclick="removeNotification(`{% url 'RemoveNotifications' notification.id %}`, `{{ request.path }}`)">&times;</span>
                </div>
                {% elif notification.notification_type == 2 %}
                <div class="dropdown-item-parent">
                    <a href="{% url 'ClassNotifications' notification.id notification.Class.id %}">@{{ notification.from_user }} is going to {{notification.Class}} </a>
                    <span class="dropdown-item-close" onclick="removeNotification(`{% url 'RemoveNotifications' notification.id %}`, `{{ request.path }}`)">&times;</span>
                </div>
                {% endif %}
            {% elif notification.Event %}
                {% if notification.notification_type == 1 %}
                <div class="dropdown-item-parent">
                    <a href="{% url 'EventNotifications' notification.id notification.Event.id %}">@{{ notification.from_user }} subscribed {{notification.Event}} </a>
                    <span class="dropdown-item-close" onclick="removeNotification(`{% url 'RemoveNotifications' notification.id %}`, `{{ request.path }}`)">&times;</span>
                </div>
                {% elif notification.notification_type == 2 %}
                <div class="dropdown-item-parent">
                    <a href="{% url 'EventNotifications' notification.id notification.Event.id %}">@{{ notification.from_user }} is going to {{notification.Event}} </a>
                    <span class="dropdown-item-close" onclick="removeNotification(`{% url 'RemoveNotifications' notification.id %}`, `{{ request.path }}`)">&times;</span>
                </div>
                {% endif %}
            {% else %}
            <div class="dropdown-item-parent">
                <a href="{% url 'FollowNotifications' notification.id notification.from_user.id %}">@{{ notification.from_user }} has started following you </a>
                <span class="dropdown-item-close" onclick="removeNotification(`{% url 'RemoveNotifications' notification.id %}`, `{{ request.path }}`)">&times;</span>
            </div>
            {% endif %}
        {% endfor %}
    </div>
</div>

<script>
    function showNotifications(){
        const container = document.getElementById('notification-container');
        if (container.classList.contains('d-none')){
            container.classList.remove('d-none');
        }
        else
        {
            container.classList.add('d-none');
        }
    }
    function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            // Does this cookie string begin with the name we want?
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

function removeNotification(removeNotificationURL,redirectURL){
    const csrftoken = getCookie('csrftoken');
    let xmlhttp = XMLHttpRequest();
    xmlhttp.onreadystatechange = function(){
        if (xmlhttp.readyState == XMLHttpRequest.DONE){
            if(xmlhttp.status == 200){
                window.location.replace(redirectURL)
            }else{
                    alert('There was an error');
            }
        }

    };

    xmlhttp.open("DELETE",removeNotificationURL,true);
    xmlhttp.setRequestHeader("X-CSRFToken", csrftoken);
    xmlhttp.send();
}
    
</script>